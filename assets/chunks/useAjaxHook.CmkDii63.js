import{g as e}from"./index.DOObuXoO.js";import{a as r}from"./index.6vUEYOb4.js";import{k as t,c as a,g as n,$ as i,a0 as l}from"./naive-ui.DyEX4l5m.js";var u=Object.prototype.hasOwnProperty;function o(e,r,t){for(t of e.keys())if(f(t,r))return t}function f(e,r){var t,a,n;if(e===r)return!0;if(e&&r&&(t=e.constructor)===r.constructor){if(t===Date)return e.getTime()===r.getTime();if(t===RegExp)return e.toString()===r.toString();if(t===Array){if((a=e.length)===r.length)for(;a--&&f(e[a],r[a]););return-1===a}if(t===Set){if(e.size!==r.size)return!1;for(a of e){if((n=a)&&"object"==typeof n&&!(n=o(r,n)))return!1;if(!r.has(n))return!1}return!0}if(t===Map){if(e.size!==r.size)return!1;for(a of e){if((n=a[0])&&"object"==typeof n&&!(n=o(r,n)))return!1;if(!f(a[1],r.get(n)))return!1}return!0}if(t===ArrayBuffer)e=new Uint8Array(e),r=new Uint8Array(r);else if(t===DataView){if((a=e.byteLength)===r.byteLength)for(;a--&&e.getInt8(a)===r.getInt8(a););return-1===a}if(ArrayBuffer.isView(e)){if((a=e.byteLength)===r.byteLength)for(;a--&&e[a]===r[a];);return-1===a}if(!t||"object"==typeof e){for(t in a=0,e){if(u.call(e,t)&&++a&&!u.call(r,t))return!1;if(!(t in r)||!f(e[t],r[t]))return!1}return Object.keys(r).length===a}}return e!=e&&r!=r}function s(u,o){const s=t(!1),c=t([]),v=t(null),d=a((()=>{const{ajax:e,dependencies:r=null,format:t=null,immediate:a=!0,labelField:i="label",options:l=null,params:o={},resultField:f="data",valueField:s="value"}=n(u);return{ajax:e,dependencies:r,format:t,immediate:a,labelField:i,options:l,params:o,resultField:f,valueField:s}})),p=a((()=>{const{dependencies:e}=n(u);return e})),m=a((()=>Object.entries(p.value||{}).filter((([e,r])=>null!==r&&""!==r&&void 0!==r)))),y=r((async()=>{const{ajax:r,resultField:t}=d.value;if(r&&!s.value){s.value=!0,v.value=null;try{const a={...d.value.params,...p.value},n=await r(a),i=e(n,t,[]);c.value=(e=>{const{format:r,labelField:t,valueField:a}=d.value;return r?e.map((e=>r(e))):e.map((e=>({...e,label:e[t],value:e[a]})))})(i)}catch(a){v.value=a,c.value=[]}finally{s.value=!1}}}),300);return i((()=>d.value.options),(e=>{const r=Array.isArray(n(e));c.value=r&&n(e)||[]}),{immediate:!0}),i((()=>p.value),((e,r)=>{console.error(e,r,"=newDeps, oldDeps="),m.value.length>0&&!s.value&&y(),r&&!f(e,r)&&(c.value=[])}),{deep:!0}),l((()=>{d.value.immediate&&!d.value.dependencies&&y()})),{error:v,loading:s,options:c,refresh:y}}export{s as u};
